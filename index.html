<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Shares</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; min-height: 100vh; overflow-x: hidden; }
.logo { font-family: 'Brush Script MT', cursive; font-size: 32px; font-weight: 400; color: white; }
.container { max-width: 100%; margin: 0 auto; background: #000; min-height: 100vh; }
.header { background: #000; padding: 12px 16px; border-bottom: 1px solid #262626; position: sticky; top: 0; z-index: 99; display: flex; align-items: center; justify-content: space-between; }
.header-icons { display: flex; gap: 20px; align-items: center; }
.header-icon { font-size: 26px; color: white; text-decoration: none; cursor: pointer; }
.stories-container { background: #000; border-bottom: 1px solid #262626; padding: 16px 0; overflow-x: auto; white-space: nowrap; }
.stories-container::-webkit-scrollbar { display: none; }
.story { display: inline-block; text-align: center; padding: 0 10px; cursor: pointer; }
.story-avatar { width: 66px; height: 66px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); padding: 3px; margin: 0 auto 8px; }
.story-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #000; }
.story-name { font-size: 12px; color: white; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.feed { padding-bottom: 60px; }
.post { background: #000; margin-bottom: 12px; border-bottom: 1px solid #262626; }
.post-header { display: flex; align-items: center; padding: 12px 16px; }
.post-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
.post-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
.post-user { font-weight: 600; font-size: 14px; color: white; }
.post-time { font-size: 12px; color: #8e8e8e; margin-left: auto; }
.post-image { width: 100%; aspect-ratio: 1; object-fit: cover; background: #1a1a1a; }
.post-actions { display: flex; gap: 16px; padding: 12px 16px; align-items: center; }
.action-btn { background: none; border: none; font-size: 26px; cursor: pointer; color: white; transition: opacity 0.2s; }
.action-btn:active { opacity: 0.5; }
.nav { background: #000; border-top: 1px solid #262626; position: fixed; bottom: 0; width: 100%; max-width: 100%; display: flex; justify-content: space-around; padding: 8px 0; z-index: 99; }
.nav-btn { background: none; border: none; font-size: 26px; cursor: pointer; color: white; padding: 8px; transition: opacity 0.2s; }
.nav-btn:active { opacity: 0.5; }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999; align-items: center; justify-content: center; }
.modal.active { display: flex; }
.modal-content { background: #262626; border-radius: 12px; padding: 24px; width: 90%; max-width: 400px; }
.modal-title { color: white; font-size: 20px; margin-bottom: 20px; text-align: center; }
.modal-btn { flex: 1; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; border: none; }
.modal-btn-primary { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); color: white; }
.modal-btn-secondary { background: #262626; color: white; }
.modal-actions { display: flex; gap: 12px; margin-top: 16px; }
input[type="file"] { display: none; }
.file-label { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); color: white; padding: 12px; border-radius: 8px; cursor: pointer; text-align: center; display: block; margin-bottom: 12px; }
textarea { width: 100%; background: #000; color: white; border: 1px solid #262626; border-radius: 8px; padding: 12px; font-family: inherit; font-size: 14px; resize: none; margin-bottom: 12px; }
input[type="text"], input[type="email"], input[type="password"] { width: 100%; background: #000; color: white; border: 1px solid #262626; border-radius: 8px; padding: 12px; font-family: inherit; font-size: 14px; margin-bottom: 12px; }
#auth { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #000; }
.auth-box { background: #262626; padding: 32px; border-radius: 12px; width: 90%; max-width: 350px; }
.auth-title { color: white; text-align: center; margin-bottom: 24px; font-family: 'Brush Script MT', cursive; font-size: 48px; }
.auth-input { width: 100%; background: #000; color: white; border: 1px solid #262626; border-radius: 8px; padding: 12px; margin-bottom: 12px; font-size: 14px; }
.auth-btn { width: 100%; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px; margin-bottom: 12px; }
.auth-link { color: #8b5cf6; text-align: center; display: block; cursor: pointer; font-size: 14px; }
.profile-container { padding: 20px 16px 80px; }
.profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
.profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: 600; flex-shrink: 0; }
.profile-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
.profile-stats { display: flex; gap: 20px; flex: 1; }
.stat { text-align: center; }
.stat-number { color: white; font-weight: 600; font-size: 18px; display: block; }
.stat-label { color: #8e8e8e; font-size: 14px; display: block; }
.profile-info { margin-bottom: 24px; }
.profile-name { color: white; font-weight: 600; font-size: 16px; margin-bottom: 4px; }
.profile-bio { color: white; font-size: 14px; margin-bottom: 4px; }
.profile-email { color: #8e8e8e; font-size: 14px; }
.edit-profile-btn { width: 100%; background: #262626; color: white; border: 1px solid #262626; padding: 8px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 24px; }
.profile-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
.profile-grid-item { aspect-ratio: 1; background: #262626; }
.profile-grid-item img { width: 100%; height: 100%; object-fit: cover; }
.profile-pic-preview { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 16px; overflow: hidden; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; font-weight: 600; }
.profile-pic-preview img { width: 100%; height: 100%; object-fit: cover; }
</style>
</head>
<body>
<div id="auth">
<div class="auth-box">
<div class="auth-title">Music Shares</div>
<div id="loginForm">
<input type="email" id="loginEmail" class="auth-input" placeholder="Email">
<input type="password" id="loginPassword" class="auth-input" placeholder="Password">
<button class="auth-btn" onclick="login()">Log In</button>
<span class="auth-link" onclick="showSignup()">Don't have an account? Sign up</span>
</div>
<div id="signupForm" style="display:none;">
<input type="email" id="signupEmail" class="auth-input" placeholder="Email">
<input type="password" id="signupPassword" class="auth-input" placeholder="Password">
<input type="text" id="signupName" class="auth-input" placeholder="Display Name" maxlength="30">
<button class="auth-btn" onclick="signup()">Sign Up</button>
<span class="auth-link" onclick="showLogin()">Already have an account? Log in</span>
</div>
</div>
</div>

<div id="app" style="display:none;">
<div class="header">
<div class="logo">Music Shares</div>
<div class="header-icons">
<span class="header-icon">‚ô•</span>
<span class="header-icon">‚úà</span>
</div>
</div>

<div class="stories-container" id="storiesContainer"></div>

<div class="feed" id="feed"></div>

<div class="nav">
<button class="nav-btn" onclick="showPage('home')">üè†</button>
<button class="nav-btn" onclick="showPage('search')">üîç</button>
<button class="nav-btn" onclick="document.getElementById('uploadModal').classList.add('active')">‚ûï</button>
<button class="nav-btn" onclick="showPage('notifications')">üîî</button>
<button class="nav-btn" onclick="showPage('profile')">üë§</button>
</div>
</div>

<div id="uploadModal" class="modal">
<div class="modal-content">
<div class="modal-title">Create Post</div>
<input type="file" id="file-input" accept="image/*">
<label for="file-input" class="file-label">Choose Photo</label>
<textarea id="caption-input" placeholder="Write a caption..." rows="3"></textarea>
<div class="modal-actions">
<button class="modal-btn modal-btn-secondary" onclick="document.getElementById('uploadModal').classList.remove('active')">Cancel</button>
<button class="modal-btn modal-btn-primary" onclick="uploadPost()">Post</button>
</div>
</div>
</div>

<div id="editProfileModal" class="modal">
<div class="modal-content">
<div class="modal-title">Edit Profile</div>
<div class="profile-pic-preview" id="profilePicPreview"></div>
<input type="file" id="profile-pic-input" accept="image/*">
<label for="profile-pic-input" class="file-label">Change Profile Picture</label>
<input type="text" id="display-name-input" placeholder="Display Name" maxlength="30">
<textarea id="bio-input" placeholder="Bio" maxlength="150" rows="3"></textarea>
<div class="modal-actions">
<button class="modal-btn modal-btn-secondary" onclick="closeEditProfile()">Cancel</button>
<button class="modal-btn modal-btn-primary" onclick="saveProfile()">Save</button>
</div>
</div>
</div>

<div id="profilePage" style="display:none; background:#000; min-height:100vh;">
<div class="header">
<div class="logo">Music Shares</div>
<div class="header-icons">
<span class="header-icon" onclick="showPage('home')">‚úï</span>
</div>
</div>
<div class="profile-container" id="profileContainer"></div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

const firebaseConfig = {
  apiKey: "AIzaSyDXNvc9z-wzwpJ_PLCVYdG-xPFQmIUIAho",
  authDomain: "truly-made-4d5e0.firebaseapp.com",
  projectId: "truly-made-4d5e0",
  storageBucket: "truly-made-4d5e0.firebasestorage.app",
  messagingSenderId: "26168906760",
  appId: "1:26168906760:web:f498d8d5cd0580329dedbd",
  measurementId: "G-ZPKV90WTSD"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);
let currentUser = null;

window.showLogin = () => {
document.getElementById('loginForm').style.display = 'block';
document.getElementById('signupForm').style.display = 'none';
};

window.showSignup = () => {
document.getElementById('signupForm').style.display = 'block';
document.getElementById('loginForm').style.display = 'none';
};

window.signup = async () => {
const email = document.getElementById('signupEmail').value;
const password = document.getElementById('signupPassword').value;
const displayName = document.getElementById('signupName').value;

if (!email || !password || !displayName) {
alert('Please fill all fields');
return;
}

try {
const userCredential = await createUserWithEmailAndPassword(auth, email, password);
const user = userCredential.user;

await setDoc(doc(db, 'users', user.uid), {
userId: user.uid,
email: email,
displayName: displayName,
bio: '',
profilePicture: '',
createdAt: new Date().toISOString()
});

alert('Account created successfully!');
} catch (error) {
alert(error.message);
}
};

window.login = async () => {
const email = document.getElementById('loginEmail').value;
const password = document.getElementById('loginPassword').value;

try {
await signInWithEmailAndPassword(auth, email, password);
} catch (error) {
alert(error.message);
}
};

onAuthStateChanged(auth, async (user) => {
if (user) {
currentUser = user;

const userDoc = await getDoc(doc(db, 'users', user.uid));
if (userDoc.exists()) {
currentUser.profile = userDoc.data();
}

document.getElementById('auth').style.display = 'none';
document.getElementById('app').style.display = 'block';
loadFeed();
loadStories();
} else {
currentUser = null;
document.getElementById('auth').style.display = 'flex';
document.getElementById('app').style.display = 'none';
}
});

window.uploadPost = async () => {
const fileInput = document.getElementById('file-input');
const caption = document.getElementById('caption-input').value;

if (!fileInput.files[0]) {
alert('Please select a photo');
return;
}

try {
const file = fileInput.files[0];
const fileRef = storageRef(storage, `posts/${Date.now()}_${file.name}`);
await uploadBytes(fileRef, file);
const photoURL = await getDownloadURL(fileRef);

await addDoc(collection(db, 'posts'), {
userId: currentUser.uid,
email: currentUser.email,
displayName: currentUser.profile?.displayName || currentUser.email.split('@')[0],
profilePicture: currentUser.profile?.profilePicture || '',
photoURL: photoURL,
caption: caption,
timestamp: new Date().toISOString()
});

document.getElementById('uploadModal').classList.remove('active');
fileInput.value = '';
document.getElementById('caption-input').value = '';
loadFeed();
} catch (error) {
alert('Error uploading post: ' + error.message);
}
};

async function loadFeed() {
const feedContainer = document.getElementById('feed');
const postsQuery = query(collection(db, 'posts'), orderBy('timestamp', 'desc'));
const querySnapshot = await getDocs(postsQuery);

feedContainer.innerHTML = '';
querySnapshot.forEach((docSnap) => {
const post = docSnap.data();
const postEl = document.createElement('div');
postEl.className = 'post';

const displayName = post.displayName || post.email.split('@')[0];
const firstLetter = displayName.charAt(0).toUpperCase();

postEl.innerHTML = `
<div class="post-header">
<div class="post-avatar">
${post.profilePicture ? `<img src="${post.profilePicture}" alt="${displayName}">` : firstLetter}
</div>
<div style="flex:1; margin-left:12px;">
<div class="post-user">${displayName}</div>
</div>
<div class="post-time">${formatTime(post.timestamp)}</div>
</div>
<img src="${post.photoURL}" class="post-image" alt="Post">
<div class="post-actions">
<button class="action-btn">‚ô•</button>
<button class="action-btn">üí¨</button>
<button class="action-btn">‚úà</button>
<button class="action-btn" style="margin-left:auto;">üîñ</button>
</div>
`;
feedContainer.appendChild(postEl);
});
}

async function loadStories() {
const storiesContainer = document.getElementById('storiesContainer');
const usersQuery = query(collection(db, 'users'));
const querySnapshot = await getDocs(usersQuery);

storiesContainer.innerHTML = '';

const currentUserStory = document.createElement('div');
currentUserStory.className = 'story';
const currentDisplayName = currentUser.profile?.displayName || 'You';
const currentFirstLetter = currentDisplayName.charAt(0).toUpperCase();
currentUserStory.innerHTML = `
<div class="story-avatar">
${currentUser.profile?.profilePicture ? `<img src="${currentUser.profile.profilePicture}" alt="${currentDisplayName}">` : `<div style="width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:24px;">${currentFirstLetter}</div>`}
</div>
<div class="story-name">Your Story</div>
`;
storiesContainer.appendChild(currentUserStory);

querySnapshot.forEach((docSnap) => {
const user = docSnap.data();
if (user.userId !== currentUser.uid) {
const storyEl = document.createElement('div');
storyEl.className = 'story';
const displayName = user.displayName || user.email.split('@')[0];
const firstLetter = displayName.charAt(0).toUpperCase();
storyEl.innerHTML = `
<div class="story-avatar">
${user.profilePicture ? `<img src="${user.profilePicture}" alt="${displayName}">` : `<div style="width:100%;height:100%;border-radius:50%;background:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:24px;">${firstLetter}</div>`}
</div>
<div class="story-name">${displayName}</div>
`;
storiesContainer.appendChild(storyEl);
}
});
}

function formatTime(timestamp) {
const now = new Date();
const postDate = new Date(timestamp);
const diffMs = now - postDate;
const diffMins = Math.floor(diffMs / 60000);
if (diffMins < 60) return diffMins + 'm';
const diffHours = Math.floor(diffMins / 60);
if (diffHours < 24) return diffHours + 'h';
const diffDays = Math.floor(diffHours / 24);
return diffDays + 'd';
}

window.showPage = async (page) => {
if (page === 'home') {
document.getElementById('app').style.display = 'block';
document.getElementById('profilePage').style.display = 'none';
loadFeed();
loadStories();
} else if (page === 'profile') {
document.getElementById('app').style.display = 'none';
document.getElementById('profilePage').style.display = 'block';
await loadProfile(currentUser.uid);
}
};

async function loadProfile(userId) {
const userDoc = await getDoc(doc(db, 'users', userId));
const profileContainer = document.getElementById('profileContainer');

if (!userDoc.exists()) {
profileContainer.innerHTML = '<div style="color:white;text-align:center;padding:20px;">Profile not found</div>';
return;
}

const userData = userDoc.data();
const displayName = userData.displayName || userData.email.split('@')[0];
const firstLetter = displayName.charAt(0).toUpperCase();

const postsQuery = query(collection(db, 'posts'));
const postsSnapshot = await getDocs(postsQuery);
const userPosts = [];
postsSnapshot.forEach((doc) => {
const post = doc.data();
if (post.userId === userId) {
userPosts.push(post);
}
});

profileContainer.innerHTML = `
<div class="profile-header">
<div class="profile-avatar">
${userData.profilePicture ? `<img src="${userData.profilePicture}" alt="${displayName}">` : firstLetter}
</div>
<div class="profile-stats">
<div class="stat">
<span class="stat-number">${userPosts.length}</span>
<span class="stat-label">posts</span>
</div>
<div class="stat">
<span class="stat-number">0</span>
<span class="stat-label">followers</span>
</div>
<div class="stat">
<span class="stat-number">0</span>
<span class="stat-label">following</span>
</div>
</div>
</div>
<div class="profile-info">
<div class="profile-name">${displayName}</div>
${userData.bio ? `<div class="profile-bio">${userData.bio}</div>` : ''}
<div class="profile-email">${userData.email}</div>
</div>
${userId === currentUser.uid ? '<button class="edit-profile-btn" onclick="openEditProfile()">Edit Profile</button>' : ''}
<div class="profile-grid">
${userPosts.map(post => `<div class="profile-grid-item"><img src="${post.photoURL}" alt="Post"></div>`).join('')}
</div>
`;
}

window.openEditProfile = async () => {
const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
if (userDoc.exists()) {
const userData = userDoc.data();
document.getElementById('display-name-input').value = userData.displayName || '';
document.getElementById('bio-input').value = userData.bio || '';

const preview = document.getElementById('profilePicPreview');
if (userData.profilePicture) {
preview.innerHTML = `<img src="${userData.profilePicture}" alt="Profile">`;
} else {
const firstLetter = (userData.displayName || userData.email.split('@')[0]).charAt(0).toUpperCase();
preview.innerHTML = firstLetter;
}
}

const picInput = document.getElementById('profile-pic-input');
picInput.onchange = (e) => {
const file = e.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = (e) => {
document.getElementById('profilePicPreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
};
reader.readAsDataURL(file);
}
};

document.getElementById('editProfileModal').classList.add('active');
};

window.closeEditProfile = () => {
document.getElementById('editProfileModal').classList.remove('active');
};

window.saveProfile = async () => {
const displayName = document.getElementById('display-name-input').value;
const bio = document.getElementById('bio-input').value;
const picInput = document.getElementById('profile-pic-input');

let profilePictureURL = currentUser.profile?.profilePicture || '';

if (picInput.files[0]) {
try {
const file = picInput.files[0];
const fileRef = storageRef(storage, `profile-pictures/${currentUser.uid}`);
await uploadBytes(fileRef, file);
profilePictureURL = await getDownloadURL(fileRef);
} catch (error) {
alert('Error uploading profile picture: ' + error.message);
return;
}
}

try {
await setDoc(doc(db, 'users', currentUser.uid), {
userId: currentUser.uid,
email: currentUser.email,
displayName: displayName,
bio: bio,
profilePicture: profilePictureURL,
createdAt: currentUser.profile?.createdAt || new Date().toISOString()
});

const updatedDoc = await getDoc(doc(db, 'users', currentUser.uid));
currentUser.profile = updatedDoc.data();

document.getElementById('editProfileModal').classList.remove('active');
await loadProfile(currentUser.uid);
loadStories();
alert('Profile updated successfully!');
} catch (error) {
alert('Error saving profile: ' + error.message);
}
};
</script>
</body>
</html>
